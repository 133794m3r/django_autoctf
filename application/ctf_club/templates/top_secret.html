{% extends "layout.html" %}
{% load static %}
{% block head %}
<script src="/static/js/vs/loader.js"></script>
<script>
	//GLOBAL VARIABLES
	// the languages that the challenge supports. Will be downloaded from the server once the base-codes are downloaded for
	// this specific challenge. This data will be updated programmatically via the templating engine eventually.
	LANGS = ['python','javascript']
	//
	BASE_CODES = {'python':'def x():\n\tprint("Hello World!")\n','javascript':'function x(){\n\tconsole.log("Hello World!");\n}'}

	document.addEventListener("DOMContentLoaded",()=>{
		document.getElementById("submit_chal").addEventListener("click",event=>{submit_chal()});
	})
	function submit_chal(){
		let el = document.getElementById("language");
		let lang = parseInt(el.options[el.selectedIndex].value);
		let code = document.getElementById('code').value;
		if(lang === -1){
			return;
		}
		submit('/top_secret_test',{'code':code,'language':lang},resp=>{
			document.getElementById('final_score').innerText = resp.score;
		});
	}

   let editor = {};
   /**
	 * Visual Studo Code's Monaco Editor are being used. Place the vs folder into static/js folder.
	 * Not committing the files into the tree as they're far too large at this time.
	 */
   require.config({paths:{vs:'/static/js/vs'}})
	require(['vs/editor/editor.main'], function () {
				editor = monaco.editor.create(document.getElementById('container'), {
					value: ['function x() {', '\tconsole.log("Hello world!");', '}'].join('\n'),
					language: 'javascript',
					 theme:'vs-dark',
				});
	});

   /**
	 * Updates the base code/langauge for the Editor context
	* @param element
	*/
   function update_language(element){
		if(element.value === -1)
			return;

		 let lang = LANGS[element.value];

		monaco.editor.setModelLanguage(editor.getModel(),lang);
		editor.setValue(BASE_CODES[lang]);
	}

</script>

{% endblock %}

{% block body %}
	<main role="main" class="col-lg">
		<div class="row mb-3">
			<div style="width:30%;">
				<select id="language" onchange="update_language(this);">
					<option value="-1">Language</option>
					<option value="0">Python</option>
					<option value="1">JavaScript</option>
				</select>
				<input type="button" class="btn-dark" id="submit_chal" value="Submit Try"/>
			</div>
			<div id="container" class="vh-75" style="width:70%;">

			</div>
		</div>
		<div class="row">
			<div class="col">
				<div class="card">
					<div class="card-header">Test Results</div>
					<div class="card-body">Test #1</div>
				</div>
			</div>
		</div>
	</main>
{% endblock %}